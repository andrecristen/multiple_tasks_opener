<%= form_with model: @issue, class: "new_issue", url: execution_tasks_path(open_from: @issue.id), method: :post, html: { multipart: true } do |form| %>
  <div class="related_tasks">
    <% @config.each_with_index do |tracker, index| %>
      <fieldset class="tracker-card">
        <legend><%= Tracker.find_by(id: tracker['type'])&.name || 'Tipo de Atividade não encontrado' %></legend>
        <%= hidden_field_tag "related_tasks[][type]", tracker['type'] %>

        <% default_subject = "#{@issue.subject} [#{Tracker.find_by(id: tracker['type'])&.name}]" %>
        <% default_description = tracker['template'] %>

        <div class="form-group">
          <%= label_tag "related_tasks[][subject]", "Título", class: "form-label" %>
          <%= text_field_tag "related_tasks[][subject]", default_subject, class: "form-control" %>
        </div>

        <div class="form-group">
          <%= label_tag "related_tasks[][description]", "Descrição", class: "form-label" %>
          <%= text_area_tag "related_tasks[][description]", default_description, class: "form-control", rows: 3 %>
        </div>

        <div class="form-group">
          <%= label_tag "related_tasks[][assigned_to_id]", "Atribuído para", class: "form-label" %>
          <%= select_tag "related_tasks[][assigned_to_id]", options_for_select(User.all.collect { |u| [u.name, u.id] }), class: "form-select" %>
        </div>

        <div class="form-group">
          <%= label_tag "related_tasks[][estimated_hours]", "Tempo Estimado", class: "form-label" %>
          <%= text_field_tag "related_tasks[][estimated_hours]", nil, class: "form-control", placeholder: "Horas estimadas" %>
        </div>
      </fieldset>
    <% end %>
  </div>

  <%= form.submit "Criar Tarefas", class: "btn btn-primary mt-3" %>
<% end %>

<style>
    .related_tasks {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    .tracker-card {
        border: 1px solid #ddd;
        padding: 15px;
        border-radius: 8px;
        background: #f9f9f9;
    }

    .form-group {
        margin-bottom: 10px;
    }

    .form-label {
        font-weight: bold;
        display: block;
    }

    .form-control,
    .form-select {
        width: 100%;
        margin: 8px 0;
        border: 1px solid #ccc;
        border-radius: 5px;
    }

</style>